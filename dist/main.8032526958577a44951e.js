(()=>{"use strict";function e(e,t){if(!t)return;const o=document.querySelector("#input-search");o&&o.addEventListener("input",()=>{const r=o.value.toLowerCase();e.innerHTML="";const n=t.filter(e=>e.title.toLowerCase().includes(r)),c=document.querySelector("#template-product");c&&n.forEach(t=>{const o=c.content.cloneNode(!0).firstElementChild,r=o.querySelector("#title-product"),n=o.querySelector("#price-product"),u=o.querySelector("#image-product");r&&(r.textContent=t.title),n&&(n.textContent=`$${t.price}`),u&&t.images[0]&&(u.src=t.images[0]),e.appendChild(o)})})}function t(e,t,o){if(!e||!t||!o)return;const r=()=>{e.style.visibility="hidden",document.body.style.overflow=""};e.addEventListener("click",t=>{t.target===e&&r()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&r()}),o.addEventListener("click",()=>{e.style.visibility="hidden",document.body.style.overflow=""}),e.style.visibility="visible",document.body.style.overflow="hidden"}const o=document.querySelector("#places__list");document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".sidebar")&&function(){const e=document.querySelectorAll("li"),t=document.querySelector(".menu-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>{e.classList.remove("active")}),t.classList.contains("active")?t.classList.remove("active"):t.classList.add("active")})}),null==t||t.addEventListener("click",function(e){var t;const o=document.querySelector(".sidebar");null===(t=null==o?void 0:o.classList)||void 0===t||t.toggle("close")})}(),o&&function(t){var o,r,n,c;o=this,r=void 0,c=function*(){if(t)try{const o=yield fetch("https://dummyjson.com/products");if(!o.ok){const e=404===o.status?"Просим наши извинения":"Товары не найдены";throw new Error(e)}const r=yield o.json();r.products.forEach(e=>{var o;const r={title:e.title||e.name||"Без названия",price:e.price,description:e.description||"",image:(null===(o=e.images)||void 0===o?void 0:o[0])||"",id:`${e.id}`},n=`album-${e.id}`.replace(/[^a-zA-Z0-9-_]/g,"").toLowerCase(),c=document.querySelector("#template-product").content.cloneNode(!0);c.querySelector("#title-product").textContent=r.title,c.querySelector("#price-product").textContent=`$${r.price}`,c.querySelector("#description").textContent=r.description,c.querySelector("#image-product").src=r.image,c.querySelector(".product").id=`product-${r.id}`,c.querySelector(".product").classList.add(`product-${n}`),t.appendChild(c)}),e(t,r.products)}catch(e){console.error("❌ Ошибка API:",e),t.innerHTML=e instanceof Error?e.message:"Неизвестная ошибка"}},new((n=void 0)||(n=Promise))(function(e,t){function u(e){try{l(c.next(e))}catch(e){t(e)}}function i(e){try{l(c.throw(e))}catch(e){t(e)}}function l(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n(function(e){e(o)})).then(u,i)}l((c=c.apply(o,r||[])).next())})}(o),document.querySelector(".registry")&&function(){const e=document.querySelector(".registry");null==e||e.addEventListener("submit",function(t){t.preventDefault();const o=e.querySelector(".name-input"),r=e.querySelector(".email-input"),n=e.querySelector(".phone-input"),c=e.querySelector(".password-input"),u={name:o,email:r,phone:n,avatar:e.querySelector(".image-input"),password:c};localStorage.setItem("dataUsers",JSON.stringify(u)),window.location.href="home.html"})}(),(document.querySelector(".profile")||document.querySelector(".sidebar"))&&function(){const e=JSON.parse(localStorage.getItem("userProfile")||"{}");if(e){document.querySelector(".profile")&&(document.querySelector(".name").textContent=e.name,document.querySelector(".email").textContent=e.email,document.querySelector(".phone").textContent=e.phone,document.querySelector(".profile-avatar img").src=e.avatar),document.querySelector(".sidebar")&&(document.querySelector(".user-name").textContent=e.name,document.querySelector(".user-phone").textContent=e.phone,document.querySelector(".user-image img").src=e.avatar);const t=document.querySelector(".profile");null!==t&&(t.style.display="flex")}else window.location.href="home.html"}(),document.querySelector(".popup-product")&&function(e=document.body){document.querySelector(".create-product");const o=document.querySelector("#save-product"),r=document.querySelector(".popup-product"),n=null==r?void 0:r.querySelector(".popup__form");null==e||e.addEventListener("click",e=>{if(e.preventDefault(),e.target.matches(".create-product")){const o=null==r?void 0:r.querySelector("#button-close");if(!r||!n||!o)return;t(r,e.target,o)}}),null==o||o.addEventListener("click",e=>{return t=this,o=void 0,c=function*(){var t,o,r;e.preventDefault();const c=new FormData(n),u=Object.fromEntries(c),i=document.querySelector("#product-name").value+` ${Date.now()}`,l=null===(t=document.querySelector("#product-price"))||void 0===t?void 0:t.value,d=null===(o=document.querySelector("#description-product"))||void 0===o?void 0:o.value,s=null===(r=document.querySelector("#product-image"))||void 0===r?void 0:r.src,a=Object.assign(Object.assign({},u),{title:i,price:Number(l),description:d,categoryId:1,images:[s]});try{const e=yield fetch("https://api.escuelajs.co/api/v1/products/",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}),t=document.querySelector("#template-product").content.cloneNode(!0);if(!e.ok){const t=yield e.json();throw new Error(`Error ${e.status}: ${t.message||JSON.stringify(t)}`)}const o=yield e.json();class r{constructor(e,t,o,r,n){this.name=e,this.price=t,this.image=o,this.description=r,this.container=n}render(){this.container.querySelector("#title-product").textContent=this.name,this.container.querySelector("#price-product").textContent=`${this.price}$`,this.container.querySelector("#description").textContent=this.description,this.container.querySelector("#image-product").src=this.image}}new r(i,l,s,d,t),o.render();const c=document.querySelector("#places__list");null==c||c.prepend(t),n.reset()}catch(e){console.error("Ошибка создания товара:",e),alert(`Ошибка: ${e instanceof Error?e.message:"неизвестная ошибка"}`)}},new((r=void 0)||(r=Promise))(function(e,n){function u(e){try{l(c.next(e))}catch(e){n(e)}}function i(e){try{l(c.throw(e))}catch(e){n(e)}}function l(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r(function(e){e(o)})).then(u,i)}l((c=c.apply(t,o||[])).next())});var t,o,r,c})}(),document.querySelector("#form-search")&&e(o),document.querySelector(".popup__form")&&function(){const e=document.querySelector(".popup__type-profile-edit");if(!e)return;const o=e.querySelector(".popup__form"),r=o.querySelector(".button-close"),n=document.querySelector(".profile-button-changes");document.querySelector(".profile-save").addEventListener("click",e=>{e.preventDefault();const t=o.querySelector("#profile-avatar").value,r=o.querySelector("#profile-name").value,n=o.querySelector("#profile-email").value,c=o.querySelector("#profile-phone").value;document.querySelector(".profile-avatar img").src=t,document.querySelector(".name").textContent=r,document.querySelector(".email").textContent=n,document.querySelector(".phone").textContent=c,document.querySelector(".user-name").textContent=r,document.querySelector(".user-phone").textContent=c,document.querySelector(".user-image img").src=t}),n.addEventListener("click",o=>{t(e,n,r)})}(),function(e=document.body){const o=document.querySelector(".popup-window-product.popup");function r(){const e=null==o?void 0:o.querySelector(".content-product");e&&e.remove();const t=document.querySelector("#template-product-modal");if(!t)return;const r=t.content.cloneNode(!0);null==o||o.appendChild(r)}r(),e.addEventListener("click",e=>{if(e.target.matches(".buy")){const n=e.target.closest(".product-container");if(!n)return;const c=n.querySelector("#title-product"),u=(null==c?void 0:c.textContent)||"",i=n.querySelector("#image-product"),l=(null==i?void 0:i.src)||"",d=n.querySelector("#description"),s=(null==d?void 0:d.textContent)||"";r();const a=null==o?void 0:o.querySelector(".close-button");document.querySelector(".popup-content__title-product").textContent=u,document.querySelector("#popup-content__image").src=l,document.querySelector("#popup-content__description").textContent=s,t(o,e.target,a)}})}()})})();