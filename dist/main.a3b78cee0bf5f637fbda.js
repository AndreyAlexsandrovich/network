(()=>{"use strict";function e(e){const t=e.querySelector("#bookmark__button");if(!t)return;const o=e.querySelector(".star-icons");if(!o)return;const r=document.querySelector(".circle-input");if(!r)return;let n=null==r?void 0:r.querySelector("p");if(!n)return;let c=parseInt(n.textContent||"0")||0;r.style.display="none",t.addEventListener("click",()=>{if(!t.querySelector(".add-bookmark")&&(c<=0||c>=0)){o.style.display="none";const e=document.createElement("h4");e.className="add-bookmark",e.textContent="В избранном",t.appendChild(e),r.style.display="block",c+=1,n.textContent=`${c}`,setTimeout(()=>{o.style.display="flex",e.remove()},3e3)}})}function t(e,t,o){if(!e||!t||!o)return;const r=()=>{e.style.visibility="hidden",document.body.style.overflow=""};e.addEventListener("click",t=>{t.target===e&&r()}),document.addEventListener("keydown",e=>{"Escape"===e.key&&r()}),o.addEventListener("click",()=>{e.style.visibility="hidden",document.body.style.overflow=""}),e.style.visibility="visible",document.body.style.overflow="hidden"}const o=document.querySelector("#places__list");document.addEventListener("DOMContentLoaded",()=>{document.querySelector(".sidebar")&&function(){const e=document.querySelectorAll("li"),t=document.querySelector(".menu-btn");e.forEach(t=>{t.addEventListener("click",()=>{e.forEach(e=>{e.classList.remove("active")}),t.classList.contains("active")?t.classList.remove("active"):t.classList.add("active")})}),null==t||t.addEventListener("click",function(e){var t;const o=document.querySelector(".sidebar");null===(t=null==o?void 0:o.classList)||void 0===t||t.toggle("close")})}(),o&&function(t){var o,r,n,c;o=this,r=void 0,c=function*(){if(t)try{const o=yield fetch("https://dummyjson.com/products");if(!o.ok){const e=404===o.status?"Просим наши извинения":"Товары не найдены";throw new Error(e)}(yield o.json()).products.forEach(o=>{var r;const n={title:o.title||o.name||"Без названия",price:o.price,description:o.description||"",image:(null===(r=o.images)||void 0===r?void 0:r[0])||"",id:o.id},c=`album-${o.id}`.replace(/[^a-zA-Z0-9-_]/g,"").toLowerCase(),u=document.querySelector("#template-product").content.cloneNode(!0);u.querySelector("#title-product").textContent=n.title,u.querySelector("#price-product").textContent=`$${n.price}`,u.querySelector("#description").textContent=n.description,u.querySelector("#image-product").src=n.image,u.querySelector(".product").id=`product-${n.id}`,u.querySelector(".product").classList.add(`product-${c}`),e(u),t.appendChild(u)})}catch(e){console.error("❌ Ошибка API:",e),t.innerHTML=e instanceof Error?e.message:"Неизвестная ошибка"}},new((n=void 0)||(n=Promise))(function(e,t){function u(e){try{l(c.next(e))}catch(e){t(e)}}function i(e){try{l(c.throw(e))}catch(e){t(e)}}function l(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n(function(e){e(o)})).then(u,i)}l((c=c.apply(o,r||[])).next())})}(o),document.querySelector(".registry")&&function(){const e=document.querySelector(".registry");null==e||e.addEventListener("submit",function(t){t.preventDefault();const o=e.querySelector(".name-input"),r=e.querySelector(".email-input"),n=e.querySelector(".phone-input"),c=e.querySelector(".password-input"),u={name:o,email:r,phone:n,avatar:e.querySelector(".image-input"),password:c};localStorage.setItem("dataUsers",JSON.stringify(u)),window.location.href="home.html"})}(),(document.querySelector(".profile")||document.querySelector(".sidebar"))&&function(){const e=JSON.parse(localStorage.getItem("userProfile")||"{}");if(e){document.querySelector(".profile")&&(document.querySelector(".name").textContent=e.name,document.querySelector(".email").textContent=e.email,document.querySelector(".phone").textContent=e.phone,document.querySelector(".profile-avatar img").src=e.avatar),document.querySelector(".sidebar")&&(document.querySelector(".user-name").textContent=e.name,document.querySelector(".user-phone").textContent=e.phone,document.querySelector(".user-image img").src=e.avatar);const t=document.querySelector(".profile");null!==t&&(t.style.display="flex")}else window.location.href="home.html"}(),document.querySelector(".popup-product")&&function(e=document.body){document.querySelector(".create-product");const o=document.querySelector("#save-product"),r=document.querySelector(".popup-product"),n=null==r?void 0:r.querySelector(".popup__form");null==e||e.addEventListener("click",e=>{if(e.preventDefault(),e.target.matches(".create-product")){const o=null==r?void 0:r.querySelector("#button-close");if(!r||!n||!o)return;t(r,e.target,o)}}),null==o||o.addEventListener("click",e=>{return t=this,o=void 0,c=function*(){var t,o,r;e.preventDefault();const c=new FormData(n),u=Object.fromEntries(c),i=document.querySelector("#product-name").value+` ${Date.now()}`,l=null===(t=document.querySelector("#product-price"))||void 0===t?void 0:t.value,d=null===(o=document.querySelector("#description-product"))||void 0===o?void 0:o.value,s=null===(r=document.querySelector("#product-image"))||void 0===r?void 0:r.src,a=Object.assign(Object.assign({},u),{title:i,price:Number(l),description:d,categoryId:1,images:[s]});try{const e=yield fetch("https://api.escuelajs.co/api/v1/products/",{method:"POST",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}),t=document.querySelector("#template-product").content.cloneNode(!0);if(!e.ok){const t=yield e.json();throw new Error(`Error ${e.status}: ${t.message||JSON.stringify(t)}`)}const o=yield e.json();class r{constructor(e,t,o,r,n){this.name=e,this.price=t,this.image=o,this.description=r,this.container=n}render(){this.container.querySelector("#title-product").textContent=this.name,this.container.querySelector("#price-product").textContent=`${this.price}$`,this.container.querySelector("#description").textContent=this.description,this.container.querySelector("#image-product").src=this.image}}new r(i,l,s,d,t),o.render();const c=document.querySelector("#places__list");null==c||c.prepend(t),n.reset()}catch(e){console.error("Ошибка создания товара:",e),alert(`Ошибка: ${e instanceof Error?e.message:"неизвестная ошибка"}`)}},new((r=void 0)||(r=Promise))(function(e,n){function u(e){try{l(c.next(e))}catch(e){n(e)}}function i(e){try{l(c.throw(e))}catch(e){n(e)}}function l(t){var o;t.done?e(t.value):(o=t.value,o instanceof r?o:new r(function(e){e(o)})).then(u,i)}l((c=c.apply(t,o||[])).next())});var t,o,r,c})}(),document.querySelector(".popup__form")&&function(){const e=document.querySelector(".popup__type-profile-edit");if(!e)return;const o=e.querySelector(".popup__form"),r=o.querySelector(".button-close"),n=document.querySelector(".profile-button-changes");document.querySelector(".profile-save").addEventListener("click",e=>{e.preventDefault();const t=o.querySelector("#profile-avatar").value,r=o.querySelector("#profile-name").value,n=o.querySelector("#profile-email").value,c=o.querySelector("#profile-phone").value;document.querySelector(".profile-avatar img").src=t,document.querySelector(".name").textContent=r,document.querySelector(".email").textContent=n,document.querySelector(".phone").textContent=c,document.querySelector(".user-name").textContent=r,document.querySelector(".user-phone").textContent=c,document.querySelector(".user-image img").src=t}),n.addEventListener("click",o=>{t(e,n,r)})}(),function(o=document.body){const r=document.querySelector(".popup-window-product.popup");function n(){const t=null==r?void 0:r.querySelector(".content-product");t&&t.remove();const o=document.querySelector("#template-product-modal").content.cloneNode(!0);e(o),null==r||r.appendChild(o)}n(),o.addEventListener("click",e=>{if(e.target.matches(".buy")){const o=e.target.closest(".product-container");if(!o)return;const c=o.querySelector("#title-product"),u=(null==c?void 0:c.textContent)||"",i=o.querySelector("#image-product"),l=(null==i?void 0:i.src)||"",d=o.querySelector("#description"),s=(null==d?void 0:d.textContent)||"";n();const a=null==r?void 0:r.querySelector(".close-button");document.querySelector(".popup-content__title-product").textContent=u,document.querySelector("#popup-content__image").src=l,document.querySelector("#popup-content__description").textContent=s,t(r,e.target,a)}})}()})})();